{"ast":null,"code":"import _objectSpread from\"D:\\\\B Tech\\\\WebD\\\\Ecommerce_webApp\\\\ecommerce-frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:\\\\B Tech\\\\WebD\\\\Ecommerce_webApp\\\\ecommerce-frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,Fragment}from'react';import{Link}from'react-router-dom';import{getBraintreeClientToken,processPayment,createOrder}from'./apiCore';import{isAuthenticated}from'../auth';import'../styles2.css';import DropIn from'braintree-web-drop-in-react';import{emptyCart}from'./cartHelpers';var Checkout=function Checkout(_ref){var products=_ref.products;var _useState=useState({success:false,clientToken:null,error:'',instance:{},address:''}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),modal=_useState4[0],makeVisible=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),sc=_useState6[0],setSc=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),ta=_useState8[0],setTa=_useState8[1];var userId=isAuthenticated()&&isAuthenticated().user._id;var token=isAuthenticated()&&isAuthenticated().token;var getToken=function getToken(userId,token){getBraintreeClientToken(userId,token).then(function(data){if(data.error){setData(_objectSpread(_objectSpread({},data),{},{error:data.error}));}else{setData({clientToken:data.clientToken});}});};useEffect(function(){getToken(userId,token);},[]);var getTotal=function getTotal(){var grandTotal=products.reduce(function(currentTotal,currentItem){return currentTotal+currentItem.count*currentItem.price;},0);return(grandTotal*100/100).toFixed(2);};var showModalFun=function showModalFun(modal){return function(){data.address?makeVisible(!modal):window.alert('Please fill in the Delivery Address to proceed');};};var showTa=function showTa(){setTa(true);setSc(false);};var handleAddress=function handleAddress(event){setData(_objectSpread(_objectSpread({},data),{},{address:event.target.value}));};var showCheckout=function showCheckout(val){return val?/*#__PURE__*/React.createElement(\"div\",null,isAuthenticated()?/*#__PURE__*/React.createElement(\"button\",{className:\"btn \",onClick:showTa,style:{background:\"yellow\"}},/*#__PURE__*/React.createElement(\"b\",null,\"Checkout ->\")):/*#__PURE__*/React.createElement(Link,{to:\"/signin\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\"},/*#__PURE__*/React.createElement(\"b\",null,\"Sign in to Checkout ->\")))):null;};var buy=function buy(){var deliveryAddress=data.address;//we send nonce to server\n//nonce=data.instance.requestPaymentMethod();\nvar nonce;var getNonce=data.instance.requestPaymentMethod().then(function(data){nonce=data.nonce;//we now send nonce to backend as paymentMethodNonce along with total amount\nvar paymentData={paymentMethodNonce:nonce,amount:getTotal(products)};processPayment(userId,token,paymentData).then(function(response){//setData({...data,success: response.success}); \nvar createOrderData={products:products,transaction_Id:response.transaction.id,amount:response.transaction.amount,address:deliveryAddress};createOrder(userId,token,createOrderData).then(function(response){emptyCart(function(){console.log(\"payment done and cart is emptied\");});setData(_objectSpread(_objectSpread({},data),{},{success:true}));});}).catch(function(err){setData(_objectSpread(_objectSpread({},data),{},{error:err}));});}).catch(function(err){setData(_objectSpread(_objectSpread({},data),{},{error:err.message}));});};var showDropIn=function showDropIn(){return/*#__PURE__*/React.createElement(\"div\",{onClick:function onClick(){return setData(_objectSpread(_objectSpread({},data),{},{error:\"\"}));}},data.clientToken!=null&&products.length>0?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(DropIn,{options:{authorization:data.clientToken},onInstance:function onInstance(instance){return data.instance=instance;}})):null);};var showError=function showError(error){return/*#__PURE__*/React.createElement(\"div\",{className:\"alert alert-danger\",style:{display:error?'':'none'}},error);};var showSuccess=function showSuccess(success){return/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"alert alert-info\",style:{display:success?'':'none'}},\"Payment Successful..!\"),/*#__PURE__*/React.createElement(\"div\",{className:\"invisible\"},success==true?setTimeout(function(){return window.location.reload();},300):null));};var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),load=_useState10[0],showLoad=_useState10[1];var showLoading=function showLoading(){if(load){return/*#__PURE__*/React.createElement(\"div\",{id:\"loading\",className:\"text-muted\"},/*#__PURE__*/React.createElement(\"h6\",null,\"This may take a few seconds... Please refrain from reloading or closing tab.\"));}};var showModal=function showModal(modal){return modal?/*#__PURE__*/React.createElement(\"div\",{id:\"myModal1\",className:\"modal1\"},/*#__PURE__*/React.createElement(\"div\",{className:\"modal1-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"modal1-header\"},/*#__PURE__*/React.createElement(\"span\",{onClick:showModalFun(modal),className:\"close\"},\"\\xD7\"),/*#__PURE__*/React.createElement(\"p\",{className:\"mt-3\"},/*#__PURE__*/React.createElement(\"b\",null,\"Please fill in the details to continue.\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"modal1-body\"},showError(data.error),showSuccess(data.success),showLoading(),/*#__PURE__*/React.createElement(\"div\",{className:\"invisible\"},setTimeout(function(){return showLoad(false);},3000)),/*#__PURE__*/React.createElement(\"div\",null,showDropIn(),data.success?null:/*#__PURE__*/React.createElement(\"button\",{onClick:buy,style:{float:\"right\"}},\"Pay\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"modal1-footer\"}))):null;};var showPayment=function showPayment(val){return val&&/*#__PURE__*/React.createElement(\"div\",{className:\"mb-4\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Delivery Address\"),/*#__PURE__*/React.createElement(\"textarea\",{onChange:handleAddress,className:\"form-control\",value:data.address,placeholder:\"Type delivery address...\"}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn mt-3\",onClick:showModalFun(modal),style:{float:\"right\",background:\"orange\"}},/*#__PURE__*/React.createElement(\"b\",null,\"Proceed to Pay ->\")));};return/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(\"table\",{id:\"bill\",className:\"mb-5\"},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null,\"Product\"),/*#__PURE__*/React.createElement(\"th\",null,\"Price(Rs)\"),/*#__PURE__*/React.createElement(\"th\",null,\"Quantity\"),/*#__PURE__*/React.createElement(\"th\",null,\"Total(Rs)\"))),/*#__PURE__*/React.createElement(\"tbody\",null,products.map(function(p,i){return/*#__PURE__*/React.createElement(\"tr\",{key:i},/*#__PURE__*/React.createElement(\"td\",null,p.name),/*#__PURE__*/React.createElement(\"td\",null,p.price),/*#__PURE__*/React.createElement(\"td\",null,p.count),/*#__PURE__*/React.createElement(\"td\",null,p.count*p.price));})),/*#__PURE__*/React.createElement(\"tfoot\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",{colSpan:\"3\"},/*#__PURE__*/React.createElement(\"center\",null,/*#__PURE__*/React.createElement(\"b\",null,\"Grand total:-\"))),/*#__PURE__*/React.createElement(\"td\",{style:{background:\"#003399\",color:\"white\"}},/*#__PURE__*/React.createElement(\"b\",null,\"Rs \",getTotal(),\" \"))))),showPayment(ta),/*#__PURE__*/React.createElement(\"div\",{style:{marginBottom:\"100px\",float:\"right\"}},showCheckout(sc)),/*#__PURE__*/React.createElement(\"div\",{className:\"mt-5\"},showModal(modal)));};export default Checkout;","map":{"version":3,"sources":["D:/B Tech/WebD/Ecommerce_webApp/ecommerce-frontend/src/core/Checkout.js"],"names":["React","useState","useEffect","Fragment","Link","getBraintreeClientToken","processPayment","createOrder","isAuthenticated","DropIn","emptyCart","Checkout","products","success","clientToken","error","instance","address","data","setData","modal","makeVisible","sc","setSc","ta","setTa","userId","user","_id","token","getToken","then","getTotal","grandTotal","reduce","currentTotal","currentItem","count","price","toFixed","showModalFun","window","alert","showTa","handleAddress","event","target","value","showCheckout","val","background","buy","deliveryAddress","nonce","getNonce","requestPaymentMethod","paymentData","paymentMethodNonce","amount","response","createOrderData","transaction_Id","transaction","id","console","log","catch","err","message","showDropIn","length","authorization","showError","display","showSuccess","setTimeout","location","reload","load","showLoad","showLoading","showModal","float","showPayment","map","p","i","name","color","marginBottom"],"mappings":"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","sourcesContent":["import React,{useState,useEffect,Fragment} from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {getBraintreeClientToken,processPayment,createOrder} from './apiCore';\r\nimport {isAuthenticated} from '../auth';\r\nimport '../styles2.css'\r\nimport DropIn from 'braintree-web-drop-in-react';\r\nimport {emptyCart} from './cartHelpers';\r\n\r\n\r\nconst Checkout=({products})=>{\r\n\r\n    const [data,setData]=useState({\r\n        success:false,\r\n        clientToken: null,\r\n        error:'',\r\n        instance:{},\r\n        address:''\r\n    });\r\n\r\n    const [modal,makeVisible]=useState(false);\r\n    const [sc,setSc]=useState(true);\r\n    const [ta,setTa]=useState(false);\r\n\r\n    const userId=isAuthenticated() && isAuthenticated().user._id;\r\n    const token=isAuthenticated() && isAuthenticated().token;\r\n\r\n    const getToken=(userId,token)=>{\r\n        getBraintreeClientToken(userId,token)\r\n            .then(data=>{\r\n                if(data.error){\r\n                    setData({...data,error: data.error});\r\n                }else{\r\n                    setData({clientToken:data.clientToken});\r\n                }\r\n            })\r\n    };\r\n\r\n    useEffect(()=>{\r\n        getToken(userId,token);\r\n    },[]);\r\n\r\n    const getTotal=()=>{\r\n        var grandTotal=products.reduce((currentTotal,currentItem)=>{\r\n            return currentTotal + (currentItem.count * currentItem.price);\r\n        },0);\r\n        return ((grandTotal*100)/100).toFixed(2);\r\n    };\r\n\r\n    const showModalFun=modal=>()=>{ \r\n        data.address ? makeVisible(!modal) : \r\n                    window.alert('Please fill in the Delivery Address to proceed');           \r\n    };\r\n\r\n    const showTa=()=>{\r\n        setTa(true);\r\n        setSc(false);\r\n    }\r\n\r\n    const handleAddress=event=>{\r\n        setData({...data,address:event.target.value});\r\n    }\r\n\r\n    const showCheckout=val=>(\r\n        val? (<div>\r\n            {isAuthenticated() ? (\r\n                    <button className=\"btn \" onClick={showTa} style={{background:\"yellow\"}}>\r\n                       <b>Checkout -&gt;</b>\r\n                    </button>\r\n                ):(\r\n                    <Link to=\"/signin\">\r\n                        <button className=\"btn btn-primary\">\r\n                            <b>Sign in to Checkout -&gt;</b>\r\n                        </button>\r\n                    </Link>\r\n            )}\r\n        </div>):null\r\n    );\r\n\r\n    const buy=()=>{\r\n        let deliveryAddress=data.address;\r\n        //we send nonce to server\r\n        //nonce=data.instance.requestPaymentMethod();\r\n        let nonce;\r\n        let getNonce=data.instance.requestPaymentMethod()\r\n            .then(data=>{\r\n                nonce=data.nonce;\r\n                //we now send nonce to backend as paymentMethodNonce along with total amount\r\n\r\n                const paymentData={\r\n                    paymentMethodNonce: nonce,\r\n                    amount: getTotal(products)\r\n                };\r\n\r\n                processPayment(userId,token,paymentData)\r\n                .then(response=>{  \r\n                    //setData({...data,success: response.success}); \r\n\r\n                \r\n                const createOrderData={\r\n                    products: products,\r\n                    transaction_Id: response.transaction.id,\r\n                    amount: response.transaction.amount,\r\n                    address: deliveryAddress\r\n                }\r\n                \r\n\r\n                createOrder(userId,token,createOrderData)\r\n                    .then(response=>{\r\n                        emptyCart(()=>{\r\n                            console.log(\"payment done and cart is emptied\");\r\n                        });\r\n                        setData({...data,success: true}); \r\n                    })            \r\n                })\r\n                .catch(err=>{\r\n                    setData({...data,error:err});\r\n                });\r\n\r\n            })\r\n            .catch(err=>{\r\n                setData({...data,error: err.message});\r\n            });\r\n    };\r\n\r\n\r\n    const showDropIn=()=>(\r\n        <div onClick={()=>setData({...data,error:\"\"})}>\r\n            {data.clientToken!=null && products.length>0 ? (\r\n                <div >\r\n                    <DropIn options={{\r\n                            authorization: data.clientToken\r\n                        }} onInstance={instance=>(data.instance=instance)}\r\n                    />\r\n                    \r\n                </div>   \r\n            ):(null)}\r\n        </div>\r\n\r\n    );\r\n\r\n    const showError=error=>(\r\n        <div className=\"alert alert-danger\" style={{display:error?'':'none'}}>\r\n            {error}\r\n        </div>\r\n    );\r\n\r\n    const showSuccess=success=>(\r\n        <Fragment>\r\n            <div className=\"alert alert-info\" style={{display:success?'':'none'}}>\r\n                Payment Successful..!\r\n            </div>\r\n            <div className=\"invisible\">\r\n                {(success==true)?setTimeout(()=>window.location.reload(),300):null}\r\n            </div>\r\n        </Fragment>\r\n    );\r\n\r\n    const [load,showLoad]=useState(true)\r\n    const showLoading=()=>{\r\n        if(load){\r\n            return (\r\n                <div id=\"loading\" className=\"text-muted\">\r\n                    <h6>This may take a few seconds... Please refrain from reloading or closing tab.</h6>\r\n                </div>\r\n            )\r\n        }\r\n        \r\n    }\r\n\r\n    const showModal=(modal)=> modal? (\r\n            <div id=\"myModal1\" className=\"modal1\" >                \r\n                <div className=\"modal1-content\"  >\r\n                    <div className=\"modal1-header\">\r\n                        <span onClick={showModalFun(modal)} className=\"close\">&times;</span>\r\n                        <p className=\"mt-3\"><b>Please fill in the details to continue.</b></p>\r\n                    </div>\r\n                    <div className=\"modal1-body\" >\r\n                        {showError(data.error)}\r\n                        {showSuccess(data.success)}\r\n                        {showLoading()}\r\n                        <div className='invisible'>{setTimeout(()=>showLoad(false),3000)}</div>\r\n                        <div>\r\n                            {showDropIn()}\r\n                            {data.success? null:(\r\n                                <button onClick={buy} style={{float:\"right\"}}>Pay</button>)}\r\n                        </div>                        \r\n                    </div>\r\n                    <div className=\"modal1-footer\"></div>                    \r\n                </div>\r\n            </div>\r\n        ):(null);\r\n \r\n\r\n    const showPayment=val=>{\r\n        return (val && <div className=\"mb-4\">\r\n        <h3>Delivery Address</h3>\r\n        <textarea onChange={handleAddress} className=\"form-control\"\r\n            value={data.address} placeholder=\"Type delivery address...\" />\r\n            \r\n        <button className=\"btn mt-3\" onClick={showModalFun(modal)} style={{float:\"right\",background:\"orange\"}}>\r\n            <b>Proceed to Pay -&gt;</b>\r\n        </button>    \r\n    </div> )\r\n    }\r\n    \r\n\r\n    return (\r\n        <Fragment>\r\n            <table id=\"bill\" className=\"mb-5\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Product</th>\r\n                        <th>Price(Rs)</th>\r\n                        <th>Quantity</th>\r\n                        <th>Total(Rs)</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                {products.map((p,i)=>(\r\n                    <tr key={i}>\r\n                        <td>{p.name}</td>\r\n                        <td>{p.price}</td>\r\n                        <td>{p.count}</td>\r\n                        <td>{p.count * p.price}</td>\r\n                    </tr>\r\n                ))}\r\n                </tbody>\r\n                <tfoot>\r\n                    <tr >\r\n                        <td colSpan=\"3\"><center><b>Grand total:-</b></center></td>\r\n                        <td style={{background:\"#003399\",color:\"white\"}}><b>Rs {getTotal()} </b></td>\r\n                    </tr>\r\n                </tfoot>\r\n            </table>  \r\n\r\n            {showPayment(ta)}\r\n\r\n            <div style={{marginBottom :\"100px\",float: \"right\"}}>\r\n                {showCheckout(sc)}                                \r\n            </div>\r\n            <div className=\"mt-5\">\r\n                {showModal(modal)}\r\n            </div>\r\n            \r\n        </Fragment>\r\n\r\n    )\r\n};\r\n\r\nexport default Checkout;"]},"metadata":{},"sourceType":"module"}
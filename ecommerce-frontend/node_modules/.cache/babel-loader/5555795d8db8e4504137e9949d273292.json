{"ast":null,"code":"var _jsxFileName = \"D:\\\\B Tech\\\\WebD\\\\ecommerce-frontend\\\\src\\\\core\\\\Checkout.js\";\nimport React, { useState, useEffect, Fragment } from 'react';\nimport { Link } from 'react-router-dom';\nimport Layout from './Layout';\nimport { getProducts, getBraintreeClientToken, processPayment } from './apiCore';\nimport Card from './Card';\nimport { isAuthenticated } from '../auth';\nimport '../styles2.css';\nimport DropIn from 'braintree-web-drop-in-react';\nimport { emptyCart } from './cartHelpers';\n\nconst Checkout = ({\n  products\n}) => {\n  const [data, setData] = useState({\n    success: false,\n    clientToken: null,\n    error: '',\n    instance: {},\n    address: ''\n  });\n\n  const userId = isAuthenticated() && isAuthenticated().user._id;\n\n  const token = isAuthenticated() && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getBraintreeClientToken(userId, token).then(data => {\n      if (data.error) {\n        setData({ ...data,\n          error: data.error\n        });\n      } else {\n        setData({\n          clientToken: data.clientToken\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const getTotal = () => {\n    return products.reduce((currentTotal, currentItem) => {\n      return currentTotal + currentItem.count * currentItem.price;\n    }, 0);\n  };\n\n  const showCheckout = () => /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 9\n    }\n  }, isAuthenticated() ? /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn \",\n    style: {\n      background: \"orange\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 20\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 24\n    }\n  }, \"Proceed to Payment ->\")) : /*#__PURE__*/React.createElement(Link, {\n    to: \"/signin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 29\n    }\n  }, \"Sign in Checkout ->\"))));\n\n  const buy = () => {\n    //we send nonce to server\n    //nonce=data.instance.requestPaymentMethod();\n    let nonce;\n    let getNonce = data.instance.requestPaymentMethod().then(data => {\n      //console.log(data);\n      nonce = data.nonce; //we now send nonce to backend as paymentMethodNonce along with total amount\n      //console.log(\"nonce sent:-\"+nonce,getTotal(products));\n\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getTotal(products)\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        // console.log(response);console.log(response.success);\n        setData({ ...data,\n          success: response.success\n        });\n        emptyCart(() => {\n          console.log(\"payment dne and cart is emptied\");\n        });\n      }).catch(err => {\n        //console.log(err);\n        setData({ ...data,\n          error: err\n        });\n      });\n    }).catch(err => {\n      //console.log('dropin error:',err.message);\n      setData({ ...data,\n        error: err.message\n      });\n    });\n  };\n\n  const showDropIn = () => /*#__PURE__*/React.createElement(\"div\", {\n    onBlur: () => setData({ ...data,\n      error: \"\"\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, data.clientToken != null && products.length > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(DropIn, {\n    options: {\n      authorization: data.clientToken\n    },\n    onInstance: instance => data.instance = instance,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: buy,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 21\n    }\n  }, \"Pay\")) : console.log(\"tok= \" + data.clientToken));\n\n  const showError = error => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"alert alert-danger\",\n    style: {\n      display: error ? '' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, error);\n\n  const showSuccess = success => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"alert alert-info\",\n    style: {\n      display: success ? '' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, \"Payment Successful..!\");\n\n  const showModal = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"myModal\",\n      class: \"modal1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal1-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal1-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      class: \"close\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 25\n      }\n    }, \"\\xD7\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 25\n      }\n    }, \"text\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal1-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 25\n      }\n    }, \"some text\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal1-footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 25\n      }\n    }, \"pay\"))));\n  };\n\n  return /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"table\", {\n    id: \"bill\",\n    className: \"mb-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 25\n    }\n  }, \"Product\"), /*#__PURE__*/React.createElement(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 25\n    }\n  }, \"Price(Rs)\"), /*#__PURE__*/React.createElement(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 25\n    }\n  }, \"Quantity\"), /*#__PURE__*/React.createElement(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 25\n    }\n  }, \"Total(Rs)\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 17\n    }\n  }, products.map((p, i) => /*#__PURE__*/React.createElement(\"tr\", {\n    key: i,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 25\n    }\n  }, p.name), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 25\n    }\n  }, p.price), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 25\n    }\n  }, p.count), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 25\n    }\n  }, p.count * p.price)))), /*#__PURE__*/React.createElement(\"tfoot\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    colSpan: \"3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"center\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 49\n    }\n  }, \"Grand total:-\"))), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      background: \"#003399\",\n      color: \"white\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 74\n    }\n  }, \"Rs \", getTotal(), \" \"))))), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginBottom: \"100px\",\n      float: \"right\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  }, showCheckout()), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }\n  }, showError(data.error), showSuccess(data.success), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"myBtn\",\n    onClick: showModal(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 17\n    }\n  }, \"Open Modal\"), showDropIn()));\n};\n\nexport default Checkout;\n/*\r\n<div style={{display:\"inline\"}}>\r\n                <h5 style={{display:\"inline\"}}>Grand Total : </h5> Rs {getTotal()} \r\n            </div>\r\n\r\nstyle={{display:\"none\"}}   \r\n\r\n{showModal()}\r\n*/","map":{"version":3,"sources":["D:/B Tech/WebD/ecommerce-frontend/src/core/Checkout.js"],"names":["React","useState","useEffect","Fragment","Link","Layout","getProducts","getBraintreeClientToken","processPayment","Card","isAuthenticated","DropIn","emptyCart","Checkout","products","data","setData","success","clientToken","error","instance","address","userId","user","_id","token","getToken","then","getTotal","reduce","currentTotal","currentItem","count","price","showCheckout","background","buy","nonce","getNonce","requestPaymentMethod","paymentData","paymentMethodNonce","amount","response","console","log","catch","err","message","showDropIn","length","authorization","showError","display","showSuccess","showModal","map","p","i","name","color","marginBottom","float"],"mappings":"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","sourcesContent":["import React,{useState,useEffect,Fragment} from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport Layout from './Layout';\r\nimport {getProducts,getBraintreeClientToken,processPayment} from './apiCore';\r\nimport Card from './Card';\r\nimport {isAuthenticated} from '../auth';\r\nimport '../styles2.css'\r\nimport DropIn from 'braintree-web-drop-in-react';\r\nimport {emptyCart} from './cartHelpers';\r\n\r\n\r\nconst Checkout=({products})=>{\r\n\r\n    const [data,setData]=useState({\r\n        success:false,\r\n        clientToken: null,\r\n        error:'',\r\n        instance:{},\r\n        address:''\r\n    });\r\n\r\n    const userId=isAuthenticated() && isAuthenticated().user._id;\r\n    const token=isAuthenticated() && isAuthenticated().token;\r\n\r\n    const getToken=(userId,token)=>{\r\n        getBraintreeClientToken(userId,token)\r\n            .then(data=>{\r\n                if(data.error){\r\n                    setData({...data,error: data.error});\r\n                }else{\r\n                    setData({clientToken:data.clientToken});\r\n                }\r\n            })\r\n    };\r\n\r\n    useEffect(()=>{\r\n        getToken(userId,token);\r\n    },[]);\r\n\r\n    const getTotal=()=>{\r\n        return products.reduce((currentTotal,currentItem)=>{\r\n            return currentTotal + (currentItem.count * currentItem.price);\r\n        },0);\r\n    };\r\n\r\n    const showCheckout=()=>(\r\n        <div>\r\n            {isAuthenticated() ? (\r\n                   <button className=\"btn \" style={{background:\"orange\"}}>\r\n                       <b>Proceed to Payment -></b>\r\n                    </button>\r\n                ):(\r\n                    <Link to=\"/signin\">\r\n                        <button className=\"btn btn-primary\">\r\n                            <b>Sign in Checkout -></b>\r\n                        </button>\r\n                    </Link>\r\n            )}\r\n        </div>\r\n    );\r\n\r\n    const buy=()=>{\r\n        //we send nonce to server\r\n        //nonce=data.instance.requestPaymentMethod();\r\n        let nonce;\r\n        let getNonce=data.instance.requestPaymentMethod()\r\n            .then(data=>{\r\n                //console.log(data);\r\n                nonce=data.nonce;\r\n                //we now send nonce to backend as paymentMethodNonce along with total amount\r\n                //console.log(\"nonce sent:-\"+nonce,getTotal(products));\r\n\r\n                const paymentData={\r\n                    paymentMethodNonce: nonce,\r\n                    amount: getTotal(products)\r\n                };\r\n\r\n                processPayment(userId,token,paymentData)\r\n                .then(response=>{  // console.log(response);console.log(response.success);\r\n                    setData({...data,success: response.success}); \r\n                    emptyCart(()=>{\r\n                        console.log(\"payment dne and cart is emptied\");\r\n                    })\r\n                })\r\n                .catch(err=>{\r\n                    //console.log(err);\r\n                    setData({...data,error:err});\r\n                });\r\n\r\n            })\r\n            .catch(err=>{\r\n                //console.log('dropin error:',err.message);\r\n                setData({...data,error: err.message});\r\n            });\r\n    }\r\n\r\n\r\n    const showDropIn=()=>(\r\n        <div onBlur={()=>setData({...data,error:\"\"})}>\r\n            {data.clientToken!=null && products.length>0 ? (\r\n                <div >\r\n                    <DropIn options={{\r\n                            authorization: data.clientToken\r\n                        }} onInstance={instance=>(data.instance=instance)}\r\n                    />\r\n                    <button onClick={buy}>Pay</button>\r\n                </div>   \r\n            ):(console.log(\"tok= \"+data.clientToken))}\r\n        </div>\r\n\r\n    );\r\n\r\n    const showError=error=>(\r\n        <div className=\"alert alert-danger\" style={{display:error?'':'none'}}>\r\n            {error}\r\n        </div>\r\n    );\r\n\r\n    const showSuccess=success=>(\r\n        <div className=\"alert alert-info\" style={{display:success?'':'none'}}>\r\n            Payment Successful..!\r\n        </div>\r\n    );\r\n\r\n    const showModal=()=>{\r\n\r\n\r\n        return (\r\n            <div id=\"myModal\" class=\"modal1\">\r\n                <div class=\"modal1-content\">\r\n                    <div class=\"modal1-header\">\r\n                        <span class=\"close\">&times;</span>\r\n                        <p>text</p>\r\n                    </div>\r\n                    <div class=\"modal1-body\">\r\n                        <div>some text</div>\r\n                    </div>\r\n                    <div class=\"modal1-footer\">\r\n                        <button>pay</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            <table id=\"bill\" className=\"mb-5\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Product</th>\r\n                        <th>Price(Rs)</th>\r\n                        <th>Quantity</th>\r\n                        <th>Total(Rs)</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                {products.map((p,i)=>(\r\n                    <tr key={i}>\r\n                        <td>{p.name}</td>\r\n                        <td>{p.price}</td>\r\n                        <td>{p.count}</td>\r\n                        <td>{p.count * p.price}</td>\r\n                    </tr>\r\n                ))}\r\n                </tbody>\r\n                <tfoot>\r\n                    <tr >\r\n                        <td colSpan=\"3\"><center><b>Grand total:-</b></center></td>\r\n                        <td style={{background:\"#003399\",color:\"white\"}}><b>Rs {getTotal()} </b></td>\r\n                    </tr>\r\n                </tfoot>\r\n            </table>  \r\n\r\n            <div style={{marginBottom :\"100px\",float: \"right\"}}>\r\n                {showCheckout()}                \r\n            </div>\r\n            <div className=\"mt-5\">\r\n                {showError(data.error)}\r\n                {showSuccess(data.success)}\r\n                <button id=\"myBtn\" onClick={showModal()}>Open Modal</button>\r\n                \r\n                {showDropIn()}\r\n            </div>\r\n\r\n        </Fragment>\r\n\r\n    )\r\n};\r\n\r\nexport default Checkout;\r\n/*\r\n<div style={{display:\"inline\"}}>\r\n                <h5 style={{display:\"inline\"}}>Grand Total : </h5> Rs {getTotal()} \r\n            </div>\r\n\r\nstyle={{display:\"none\"}}   \r\n\r\n{showModal()}\r\n*/"]},"metadata":{},"sourceType":"module"}